{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Stage 2 Structured Extraction Schemas",
    "definitions": {
        "field_confidence": {
            "type": "number",
            "minimum": 0.0,
            "maximum": 1.0
        },
        "field_source": {
            "type": "string",
            "enum": [
                "regex",
                "heuristic",
                "inferred",
                "missing"
            ]
        },
        "field_base": {
            "type": "object",
            "required": [
                "confidence",
                "source"
            ],
            "properties": {
                "confidence": {
                    "$ref": "#/definitions/field_confidence"
                },
                "source": {
                    "$ref": "#/definitions/field_source"
                }
            }
        },
        "string_field": {
            "allOf": [
                {
                    "$ref": "#/definitions/field_base"
                },
                {
                    "properties": {
                        "value": {
                            "type": [
                                "string",
                                "null"
                            ]
                        }
                    },
                    "required": [
                        "value"
                    ]
                }
            ]
        },
        "integer_field": {
            "allOf": [
                {
                    "$ref": "#/definitions/field_base"
                },
                {
                    "properties": {
                        "value": {
                            "type": [
                                "integer",
                                "null"
                            ]
                        }
                    },
                    "required": [
                        "value"
                    ]
                }
            ]
        },
        "array_field": {
            "allOf": [
                {
                    "$ref": "#/definitions/field_base"
                },
                {
                    "properties": {
                        "value": {
                            "type": [
                                "array",
                                "null"
                            ],
                            "items": {
                                "type": "string"
                            }
                        }
                    },
                    "required": [
                        "value"
                    ]
                }
            ]
        },
        "common_envelope": {
            "type": "object",
            "required": [
                "raw_reference",
                "reference_type",
                "type_confidence",
                "extraction_status",
                "fields",
                "metadata"
            ],
            "properties": {
                "raw_reference": {
                    "type": "string"
                },
                "type_confidence": {
                    "$ref": "#/definitions/field_confidence"
                },
                "extraction_status": {
                    "type": "string",
                    "enum": [
                        "complete",
                        "partial",
                        "failed"
                    ]
                },
                "metadata": {
                    "type": "object",
                    "required": [
                        "extractor_version",
                        "notes"
                    ],
                    "properties": {
                        "extractor_version": {
                            "type": "string",
                            "const": "stage2_v1"
                        },
                        "notes": {
                            "type": "array",
                            "items": {
                                "type": "string"
                            }
                        }
                    }
                }
            }
        }
    },
    "schemas": {
        "journal": {
            "allOf": [
                {
                    "$ref": "#/definitions/common_envelope"
                },
                {
                    "properties": {
                        "reference_type": {
                            "const": "journal"
                        },
                        "fields": {
                            "type": "object",
                            "required": [
                                "authors",
                                "year",
                                "title",
                                "journal",
                                "volume",
                                "issue",
                                "pages",
                                "doi"
                            ],
                            "properties": {
                                "authors": {
                                    "$ref": "#/definitions/array_field"
                                },
                                "year": {
                                    "$ref": "#/definitions/integer_field"
                                },
                                "title": {
                                    "$ref": "#/definitions/string_field"
                                },
                                "journal": {
                                    "$ref": "#/definitions/string_field"
                                },
                                "volume": {
                                    "$ref": "#/definitions/string_field"
                                },
                                "issue": {
                                    "$ref": "#/definitions/string_field"
                                },
                                "pages": {
                                    "$ref": "#/definitions/string_field"
                                },
                                "doi": {
                                    "$ref": "#/definitions/string_field"
                                }
                            }
                        }
                    }
                }
            ]
        },
        "book": {
            "allOf": [
                {
                    "$ref": "#/definitions/common_envelope"
                },
                {
                    "properties": {
                        "reference_type": {
                            "const": "book"
                        },
                        "fields": {
                            "type": "object",
                            "required": [
                                "authors",
                                "editors",
                                "year",
                                "title",
                                "publisher",
                                "edition",
                                "place",
                                "isbn"
                            ],
                            "properties": {
                                "authors": {
                                    "$ref": "#/definitions/array_field"
                                },
                                "editors": {
                                    "$ref": "#/definitions/array_field"
                                },
                                "year": {
                                    "$ref": "#/definitions/integer_field"
                                },
                                "title": {
                                    "$ref": "#/definitions/string_field"
                                },
                                "publisher": {
                                    "$ref": "#/definitions/string_field"
                                },
                                "edition": {
                                    "$ref": "#/definitions/string_field"
                                },
                                "place": {
                                    "$ref": "#/definitions/string_field"
                                },
                                "isbn": {
                                    "$ref": "#/definitions/string_field"
                                }
                            }
                        }
                    }
                }
            ]
        },
        "website": {
            "allOf": [
                {
                    "$ref": "#/definitions/common_envelope"
                },
                {
                    "properties": {
                        "reference_type": {
                            "const": "website"
                        },
                        "fields": {
                            "type": "object",
                            "required": [
                                "title",
                                "url",
                                "author",
                                "organisation",
                                "year",
                                "access_date"
                            ],
                            "properties": {
                                "title": {
                                    "$ref": "#/definitions/string_field"
                                },
                                "url": {
                                    "$ref": "#/definitions/string_field"
                                },
                                "author": {
                                    "$ref": "#/definitions/array_field"
                                },
                                "organisation": {
                                    "$ref": "#/definitions/string_field"
                                },
                                "year": {
                                    "$ref": "#/definitions/integer_field"
                                },
                                "access_date": {
                                    "$ref": "#/definitions/string_field"
                                }
                            }
                        }
                    }
                }
            ]
        }
    }
}